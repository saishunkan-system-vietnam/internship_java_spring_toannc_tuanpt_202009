<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssv.com.mapper.ScheduleMapper">
	<resultMap type="Schedule" id="scheduleMapping">
		<id column="id_schedule" property="idSchedule" />
		<result column="schedule_start" property="timeStart" />
		<result column="schedule_end" property="timeEnd" />
		<result column="schedule_team1" property="idTeam1" />
		<result column="schedule_team2" property="idTeam2" />
		<result column="schedule_score1" property="scoreTeam1" />
		<result column="schedule_score2" property="scoreTeam2" />
		<result column="schedule_winner" property="idwinner" />
		<result column="schedule_video" property="video" />
		<result column="schedule_description" property="description" />
		<result column="schedule_address" property="address" />
		<result column="schedule_status" property="status" />
		<result column="schedule_tour" property="idTour" />
		<result column="schedule_image" property="image" />
		<result column="schedule_title" property="title" />
		<result column="tournament_name" property="nameTour" />
		<collection property="team" ofType="Team">
			<id column="id_team" property="idTeam" />
			<result column="team_name" property="nameTeam" />
			<result column="team_totalmatch" property="totalmatch" />
			<result column="team_totalwin" property="totalwin" />
			<result column="team_type" property="type" />
			<result column="team_description" property="description" />
			<result column="team_logo" property="logo" />
		</collection>
		<collection property="round" ofType="Round">
			<id column="id_round" property="idRound" />
			<result column="round_name" property="roundName" />
			<result column="round_score1" property="roundScore1" />
			<result column="round_score2" property="roundScore2" />
			<result column="round_description" property="roundDescription" />
			<result column="round_schedule" property="roundSchedule" />
		</collection>
	</resultMap>
	<resultMap type="Schedule" id="scheduleMapping1">
		<id column="id_schedule" property="idSchedule" />
		<result column="schedule_start" property="timeStart" />
		<result column="schedule_end" property="timeEnd" />
		<result column="schedule_team1" property="idTeam1" />
		<result column="schedule_team2" property="idTeam2" />
		<result column="schedule_score1" property="scoreTeam1" />
		<result column="schedule_score2" property="scoreTeam2" />
		<result column="schedule_winner" property="idwinner" />
		<result column="schedule_video" property="video" />
		<result column="schedule_description" property="description" />
		<result column="schedule_address" property="address" />
		<result column="schedule_status" property="status" />
		<result column="schedule_tour" property="idTour" />
		<result column="schedule_image" property="image" />
		<result column="schedule_title" property="title" />
		<result column="tournament_name" property="nameTour" />
		<collection property="team" ofType="Team">
			<id column="id_team" property="idTeam" />
			<result column="team_name" property="nameTeam" />
			<result column="team_totalmatch" property="totalmatch" />
			<result column="team_totalwin" property="totalwin" />
			<result column="team_type" property="type" />
			<result column="team_description" property="description" />
			<result column="team_logo" property="logo" />
			<collection property="profile" ofType="Profile">
				<id property="id" column="id" />
				<result property="name" column="profile_name" />
				<result property="email" column="profile_email" />
				<result property="phone" column="profile_phone" />
				<result property="age" column="profile_age" />
				<result property="gender" column="profile_gender" />
				<result property="address" column="profile_address" />
				<result property="avatar" column="profile_avatar" />
				<result property="idTeam" column="id_team" />
			</collection>
		</collection>
	</resultMap>

	<select id="getByIdTour" resultMap="scheduleMapping">
		Select * FROM schedule_tbl
		join tournament_tbl on
		schedule_tbl.schedule_tour=tournament_tbl.id_tournament
		inner join
		team_tbl on schedule_tbl.schedule_team1=team_tbl.id_team or
		schedule_tbl.schedule_team2=team_tbl.id_team inner join round_tbl on
		schedule_tbl.id_schedule=round_tbl.round_schedule
		where
		schedule_tour=${idTour} ORDER BY schedule_end DESC
	</select>
	<select id="getById" resultMap="scheduleMapping">
		Select * FROM schedule_tbl inner
		join tournament_tbl on
		schedule_tbl.schedule_tour=tournament_tbl.id_tournament
		inner join
		round_tbl on
		schedule_tbl.id_schedule=round_tbl.round_schedule
		inner
		join
		team_tbl on schedule_tbl.schedule_team1=team_tbl.id_team
		or
		schedule_tbl.schedule_team2=team_tbl.id_team where
		id_schedule=${idSchedule}
	</select>
	<delete id="deleteByTour" parameterType="int">
		Delete from schedule_tbl
		where schedule_tour=${idTour}
	</delete>

	<insert id="create" parameterType="Schedule">
		INSERT INTO
		schedule_tbl (
		schedule_start,
		schedule_end,
		schedule_team1,
		schedule_team2,
		schedule_title,
		schedule_address,
		schedule_tour
		)
		VALUES(
		#{timeStart},
		#{timeEnd},
		#{idTeam1},
		#{idTeam2},
		#{title},
		#{address},
		#{idTour}
		)
	</insert>

	<delete id="delete" parameterType="int">
		DELETE from schedule_tbl WHERE
		id_schedule = ${idSchedule}
	</delete>

	<update id="updateShedule" parameterType="Schedule">
		Update schedule_tbl set
		schedule_score1=#{scoreTeam1},
		schedule_score2=#{scoreTeam2},
		schedule_video=#{video},
		schedule_image=#{image},
		schedule_winner=#{idwinner},
		schedule_description=#{description}
		Where
		id_schedule=#{idSchedule};
	</update>

	<update id="updateSheduleNotFile" parameterType="Schedule">
		Update
		schedule_tbl set
		schedule_score1=#{scoreTeam1},
		schedule_score2=#{scoreTeam2},
		schedule_winner=#{idwinner},
		schedule_description=#{description}
		Where id_schedule=#{idSchedule};
	</update>

	<update id="editShedule" parameterType="Schedule">
		Update schedule_tbl set
		schedule_start=#{timeStart} ,
		schedule_end=#{timeEnd},
		schedule_team1=#{idTeam1},
		schedule_team2=#{idTeam2},
		schedule_description=#{description},
		schedule_address=#{address},
		schedule_title=#{title}
		Where
		id_schedule=#{idSchedule};
	</update>

	<update id="checkStatus">
		Update schedule_tbl set
		schedule_status=${i}
		Where
		id_schedule=${j};
	</update>

	<select id="getAll" resultMap="scheduleMapping">
		Select * FROM schedule_tbl inner
		join tournament_tbl on
		schedule_tbl.schedule_tour=tournament_tbl.id_tournament
		inner join
		team_tbl on schedule_tbl.schedule_team1=team_tbl.id_team
		or
		schedule_tbl.schedule_team2=team_tbl.id_team inner join round_tbl on
		schedule_tbl.id_schedule=round_tbl.round_schedule
	</select>

	<select id="sum" resultType="int">
		Select COUNT(*) FROM
		sports.schedule_tbl where (schedule_team1=${idTeam} or
		schedule_team2=${idTeam}) and schedule_tbl.schedule_status=2
	</select>

	<select id="sumWin" resultType="int">
		Select COUNT(*) FROM
		sports.schedule_tbl where schedule_winner=${idTeam} and
		schedule_tbl.schedule_status=2
	</select>

	<select id="sumWinJoinByTour" resultType="int">
		Select COUNT(*) FROM
		sports.schedule_tbl where schedule_winner=${idTeam} and
		schedule_tbl.schedule_status=2 and
		schedule_tour=${idTour}
	</select>

	<select id="sumJoinByTour" resultType="int">
		Select COUNT(*) FROM
		sports.schedule_tbl where (schedule_team1=${idTeam} or
		schedule_team2=${idTeam}) and schedule_tour=${idTour} and
		schedule_tbl.schedule_status=2
	</select>

	<select id="upcomingMatch" resultMap="scheduleMapping">
		Select * FROM schedule_tbl
		inner
		join tournament_tbl on
		schedule_tbl.schedule_tour=tournament_tbl.id_tournament
		inner join
		team_tbl on schedule_tbl.schedule_team1=team_tbl.id_team
		or
		schedule_tbl.schedule_team2=team_tbl.id_team
		where schedule_status=0
		order by schedule_start
	</select>

	<delete id="deleteData" parameterType="int">
		DELETE from schedule_tbl
		WHERE
		schedule_tour=${idTour} And(schedule_team1=${idTeam} OR
		schedule_team2=${idTeam})
	</delete>
	<update id="setTotalMatch" parameterType="int">
		Update team_tbl set
		team_totalmatch=${sumJoinByTour}
		Where
		id_team=${idTeam};
	</update>
	<select id="relate" resultMap="scheduleMapping">
		Select * from
		schedule_tbl inner
		join
		team_tbl on
		schedule_tbl.schedule_team1=team_tbl.id_team
		or
		schedule_tbl.schedule_team2=team_tbl.id_team

		where
		(schedule_team1=${idTeam1} or schedule_team2=${idTeam2} or
		schedule_team1=${idTeam2} or schedule_team2=${idTeam1}) and
		schedule_tour=${idTour}
	</select>
	<select id="getRecently" resultMap="scheduleMapping">
		Select *from schedule_tbl
		where (schedule_team1=${idTeam} or
		schedule_team2=${idTeam}) and
		schedule_tour=${idTour} and
		schedule_status=2 ORDER BY schedule_end
		DESC Limit 3
	</select>
	<select id="profileSchedule" resultMap="scheduleMapping1">
		SELECT p.*,s.* from profile_tbl p inner join (team_tbl t inner join schedule_tbl s on t.id_team =s.schedule_team1 or t.id_team=s.schedule_team2 ) on p.id_team = t.id_team where s.schedule_status!=2 and p.id=${idMember}
	</select>


</mapper>